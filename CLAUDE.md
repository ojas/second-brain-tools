# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

A Rust CLI tool for managing a "second brain" file system. The tool provides multiple subcommands:
- `tree`: Parses JSON tree structures (generated by the `tree` command) and outputs formatted file listings with paths, sizes, and timestamps
- `bookmarks`: Placeholder command for managing bookmarks (to be implemented)

## Development Commands

### Testing
```bash
cargo test
```

### Building
```bash
# Debug build
cargo build

# The binary will be at:
target/debug/second-brain-tools
```

### Running the Tool
```bash
# Show help
cargo run -- --help
target/debug/second-brain-tools --help

# Generate example tree data
tree -J --du -D --timefmt "%Y-%m-%d" . > tree_example.json

# Run tree subcommand with example data
cargo run -- tree tree_example.json
target/debug/second-brain-tools tree tree_example.json

# Run tree subcommand with output redirect
target/debug/second-brain-tools tree ~/sync/trees/tree_sync.json > ~/sync/trees/tree_sync.txt

# Run bookmarks subcommand (placeholder)
cargo run -- bookmarks
target/debug/second-brain-tools bookmarks [FILE]
```

## Code Architecture

### Input Format
The tool expects JSON input from the `tree` command with the `-J --du -D --timefmt "%Y-%m-%d"` flags. The JSON structure has:
- First element: Root `TreeNode` with recursive directory structure
- Second element: `ReportNode` with summary statistics (total size, file/directory counts)

### Key Data Structures (src/main.rs)

**CLI Structures:**
- `Cli`: Main CLI parser struct using clap's derive API
- `Commands`: Enum defining available subcommands (Tree, Bookmarks)

**Tree Data Structures:**
- `TreeNode`: Recursive structure representing files/directories with `node_type`, `name`, `size`, `time`, and optional `contents` array
- `ReportNode`: Summary statistics with `size`, `directories`, and `files` counts
- `TreeList`: Top-level wrapper containing one `TreeNode` and one `ReportNode`

Note: `TreeNode.node_type` uses `#[serde(rename = "type")]` because "type" is a Rust keyword.

### Core Functions

- `main()`: Entry point that parses CLI args with clap and dispatches to subcommand handlers
- `handle_tree_command()`: Handles the `tree` subcommand - loads tree JSON and outputs TSV format
- `handle_bookmarks_command()`: Handles the `bookmarks` subcommand (placeholder implementation)
- `read_tree_from_file()`: Deserializes JSON file into `TreeList` struct
- `walk_tree()`: Recursively prints tree structure with indentation
- `walk_tree_fullpath()`: Recursively prints full paths with size and timestamp in tab-separated format

### Output Format
Current output is tab-separated: `full_path\tsize\ttime`

## Dependencies

- `serde` (with derive feature): For data structure serialization/deserialization
- `serde_json`: For JSON parsing
- `clap` (with derive feature): For CLI argument parsing and subcommand management

**Note:** Requires Rust 1.74 or newer due to clap 4.5 requirements.

## Security Note

The `.crates_io_token` file contains a crates.io API token and is tracked in `.gitignore`. Do not commit this file.
